<?php

/**
 * Implements hook_theme().
 */
function pageslideregion_theme($existing, $type, $theme, $path) {
  return array(
    'block__pageslideregion' => array(
      'render element' => 'elements',
      'template' => 'block--pageslideregion',
    ),
    'region__pageslideregion' => array(
      'render element' => 'elements',
      'template' => 'region--pageslideregion',
    ),
  );
}

/**
 * Implements hook_system_info_alter().
 */
function pageslideregion_system_info_alter(&$info, $file, $type) {
  if ($type == 'theme') {
    $info['regions']['pageslideregion'] = t('PageSlide region');
  }
}

/**
 * Implements hook_page_build().
 */
function pageslideregion_page_build(&$page) {
  if (!empty($page['pageslideregion'])) {
    foreach (element_children($page['pageslideregion']) as $child) {

      // Disable contextual links.
      if (!empty($page['pageslideregion'][$child]['#contextual_links'])) {
        unset($page['pageslideregion'][$child]['#contextual_links']);
      }
    }
  }
}

/**
 * Implements hook_preprocess_block().
 */
function pageslideregion_preprocess_block(&$variables, $hook) {
  if ($variables['block']->region == 'pageslideregion') {
    if (empty($variables['block']->subject)) {
      $info = module_invoke($variables['block']->module, 'block_info');
      $variables['block']->subject = $info[$variables['block']->delta]['info'];
    }
  }
}

/**
 * Implements hook_page_alter().
 */
function pageslideregion_page_alter(&$page) {
  if (!empty($page['pageslideregion'])) {
    $page['pageslideregion']['#prefix'] = '<div id="pageslideregion" style="display:none;">';
    $page['pageslideregion']['#suffix'] = '</div>';
    $page['pageslideregion']['#attached']['js'] = array(
      ctools_attach_js('pageslide.region', 'pageslideregion') => array(
        'scope' => 'footer'
      )
    );
    $page['pageslideregion']['#attached']['css'] = array(
      ctools_attach_css('jquery-ui-1.8.19.custom', 'pageslideregion') => array(
        'scope' => 'footer'
      )
    );
    $page['pageslideregion']['#attached']['library'] = array(
      array('system', 'ui.accordion'),
      array('system', 'ui.button'),
      array('system', 'ui.resizable'),
      array('system', 'effects.slide'),
      array('system', 'jquery.cookie'),
    );
    $page['page_bottom']['pageslideregion'] = $page['pageslideregion'];
    unset($page['pageslideregion']);
  }
}

/**
 * Implements hook_module_implements_alter().
 */
function pageslideregion_module_implements_alter(&$implementations, $hook) {
  if ($hook == 'page_alter' || $hook == 'page_build') {
    $group = $implementations['pageslideregion'];
    unset($implementations['pageslideregion']);
    $implementations['pageslideregion'] = $group;
  }
}
